shared:
    image: gcc

jobs:
    main:
        environment:
            SD_SONAR_OPTS: "-Dsonar.sources=index.js -Dsonar.javascript.lcov.reportPath=artifacts/coverage/lcov.info"
        requires: [~pr, ~commit]
        steps:
            - build: make
            - run-test: -valgrind --xml=yes --xml-file=$(BUILD_DIR)/valgrind-report.xml $(BUILD_DIR)/test_component1 --gtest_output=xml:$(BUILD_DIR)/xunit-report.xml
            - coverage: gcovr -x -r . > $(BUILD_DIR)/gcovr-report.xml